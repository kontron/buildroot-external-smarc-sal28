/*
 * Device Tree Include file for Kontron SMARC-sAL28.
 */

/dts-v1/;
#include "freescale/fsl-ls1028a.dtsi"

/ {
	model = "Kontron SMARC-sAL28";
	compatible = "kontron,sl28", "fsl,ls1028a";

	aliases {
		crypto = &crypto;
		serial0 = &duart0;
		serial1 = &duart1;
	};

	chosen {
		stdout-path = "serial0:115200n8";
	};

	sys_mclk: clock-mclk {
		compatible = "fixed-clock";
		#clock-cells = <0>;
		clock-frequency = <25000000>;
	};

	reg_1p8v: regulator-1p8v {
		compatible = "regulator-fixed";
		regulator-name = "1P8V";
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
		regulator-always-on;
	};

	sound {
		compatible = "simple-audio-card";
		simple-audio-card,format = "i2s";
		simple-audio-card,widgets =
			"Microphone", "Microphone Jack",
			"Headphone", "Headphone Jack",
			"Speaker", "Speaker Ext",
			"Line", "Line In Jack";
		simple-audio-card,routing =
			"MIC_IN", "Microphone Jack",
			"Microphone Jack", "Mic Bias",
			"LINE_IN", "Line In Jack",
			"Headphone Jack", "HP_OUT",
			"Speaker Ext", "LINE_OUT";

		simple-audio-card,cpu {
			sound-dai = <&sai4>;
			frame-master;
			bitclock-master;
		};
	};
};

&esdhc {
	status = "okay";
	sd-uhs-sdr104;
	sd-uhs-sdr50;
	sd-uhs-sdr25;
	sd-uhs-sdr12;
};

&esdhc1 {
	status = "okay";
	bus-width = <8>;
	mmc-hs200-1_8v;
};

&i2c0 {
	status = "okay";
	rtc@32 {
		compatible = "microcrystal,rv8803";
		reg = <0x32>;
	};

	eeprom@50 {
		compatible = "atmel,24c32";
		reg = <0x50>;
	};
};

&i2c3 {
	status = "okay";
};

&i2c4 {
	status = "okay";
};

&duart0 {
	status = "okay";
};

&duart1 {
	status = "okay";
};

&lpuart1 {
	status = "okay";
};

&can0 {
	status = "okay";
};

&can1 {
	status = "disabled";
};

&sai4 {
	status = "okay";
};

&dp0 {
	status = "okay";
};

&mdio0 {
	phy0: ethernet-phy@5 {
		reg = <0x5>;
		// Atheros PHY on RDB seems to cause traffic loss @ 1Gbps w EEE
		eee-broken-1000t;
	};
};

&enetc_port0 {
	phy-handle = <&phy0>;
	phy-connection-type = "sgmii";
	status = "okay";
};

&enetc_port1 {
	status = "disabled";
};

&enetc_port2 {
	status = "disabled";
};

/* disabling leads to kernel crash */
//&enetc_port3 {
//	status = "disabled";
//};



/* l2switch ports */
/* port@4 has no reference in the dtsi.. */
/ {
	soc {
		pcie@1f0000000 {
			pci@0,5 {
				switch_port4: port@4 {
				};
				switch_port5: port@5 {
				};
			};
		};
	};
};

/* tmu */
&soc {
	tmu: tmu@1f80000 {
		compatible = "fsl,qoriq-tmu";
		reg = <0x0 0x1f80000 0x0 0x10000>;
		interrupts = <0 23 0x4>;
		fsl,tmu-range = <0xb0000 0xa0026 0x80048 0x70061>;
		fsl,tmu-calibration =
			/* Calibration data group 1 */
			<0x00000000 0x00000024
			0x00000001 0x0000002b
			0x00000002 0x00000031
			0x00000003 0x00000038
			0x00000004 0x0000003f
			0x00000005 0x00000045
			0x00000006 0x0000004c
			0x00000007 0x00000053
			0x00000008 0x00000059
			0x00000009 0x00000060
			0x0000000a 0x00000066
			0x0000000b 0x0000006d
			/* Calibration data group 2 */
			0x00010000 0x0000001c
			0x00010001 0x00000024
			0x00010002 0x0000002c
			0x00010003 0x00000035
			0x00010004 0x0000003d
			0x00010005 0x00000045
			0x00010006 0x0000004d
			0x00010007 0x00000055
			0x00010008 0x0000005e
			0x00010009 0x00000066
			0x0001000A 0x0000006e
			/* Calibration data group 3 */
			0x00020000 0x00000018
			0x00020001 0x00000022
			0x00020002 0x0000002d
			0x00020003 0x00000038
			0x00020004 0x00000043
			0x00020005 0x0000004d
			0x00020006 0x00000058
			0x00020007 0x00000063
			0x00020008 0x0000006e
			/* Calibration data group 4 */
			0x00030000 0x00000010
			0x00030001 0x0000001c
			0x00030002 0x00000029
			0x00030003 0x00000036
			0x00030004 0x00000042
			0x00030005 0x0000004f
			0x00030006 0x0000005b
			0x00030007 0x00000068>;
		little-endian;
		#thermal-sensor-cells = <1>;
	};

	thermal-zones {
		ddrc_thermal: ddrc-thermal {
			polling-delay-passive = <1000>;
			polling-delay = <5000>;
			thermal-sensors = <&tmu 0>;

			trips {
				ddrc_alert: ddrc-alert {
					temperature = <85000>;
					hysteresis = <2000>;
					type = "passive";
				};

				ddrc_crit: ddrc-crit {
					temperature = <95000>;
					hysteresis = <2000>;
					type = "critical";
				};
			};

			cooling-maps {
				map0 {
					trip = <&ddrc_alert>;
					cooling-device = <&cpu0 THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
				};
			};
		};

		cpu_thermal: cpu-thermal {
			polling-delay-passive = <1000>;
			polling-delay = <5000>;
			thermal-sensors = <&tmu 1>;

			trips {
				cpu_alert: cpu-alert {
					temperature = <85000>;
					hysteresis = <2000>;
					type = "passive";
				};

				cpu_crit: cpu-crit {
					temperature = <95000>;
					hysteresis = <2000>;
					type = "critical";
				};
			};

			cooling-maps {
				map0 {
					trip = <&cpu_alert>;
					cooling-device = <&cpu0 THERMAL_NO_LIMIT THERMAL_NO_LIMIT>;
				};
			};
		};
	};
};

&switch_port0 {
	status = "disabled";
};

&switch_port1 {
	status = "disabled";
};

&switch_port2 {
	status = "disabled";
};

&switch_port3 {
	status = "disabled";
};

&switch_port4 {
	status = "disabled";
};

&switch_port5 {
	status = "disabled";
};

&edp {
	fsl,no_edid;
	lane_mapping = <0x4e>;
	edp_link_rate = <0x6>;
	edp_num_lanes = <0x4>;
	status = "okay";
};

&sata {
	status = "okay";
};
